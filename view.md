# ビュー・サブクエリ

## ビュー
- ビュー : 頻繁に使用するSELECT文を保存するために用いる。ビューが実行されると，保存されたSELECT文が実行され，一時的に仮想的なテーブルに結果が保存される。データそのものは保持していないことに注意する。

Q. なぜビューを使用するのか?
- ビューを用いることで，SELECT文のみを保持して実記憶容量を削減するため
- ビューによりアクセス制限をかけることができるため，セキュリティ対策が行えるため
- ビューを保存して使いまわすことで，メンテナンス性，提供するデータの一貫性を確保するため

### ビューの作成
ここではSELECT文からビューを作成しているが，SELECT文にビューを指定して新しいビューを作成することも可能である(多段ビュー)。ただし，ビューを重ねるとパフォーマンスが低下することに注意する。
```sql
CREATE VIEW ビュー名 (ビューの列名1, ビューの列名2, ...)
AS
SELECT文
```

Shohinテーブルからshoshin_bunruiごとにカウントを行うSELECT文を実行するビューの作成例
```sql
CREATE VIEW ShohinSum(shohin_bunrui, cnt_shohin)
AS
SELECT shohin_bunrui, COUNT(*)
FROM Shohin
GROUP BY shohin_bunrui;
```

### ビューの一覧の確認
```sql
\dv
```

### ビューの定義の確認
```sql
d+ ビュー名
```

### ビューの使用
```sql
SELECT 列名1, 列名2, ...
FROM ビュー名;
```

### ビューの削除
```sql
DROP VIEW ビュー名;
```

### ビューに対する制限事項
1. ビュー定義にORDER BY句は使用できない。これはテーブルと同様にビューに行の順序がないためである。
2. ビューを指定した更新(INSERT, UPDATE, DELETE)は次の条件を満たしているときのみ実行できる。ビューが更新されると連動してテーブルも更新される。
    - SELECT句にDISTINCTが含まれていない
    - FROM句に含まれるテーブルが1つだけである
    - GROUP BY句を使用していない
    - HAVING句を使用していない
